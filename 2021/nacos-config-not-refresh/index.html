<!doctype html><html lang=zh-cn>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="chrome=1">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=robots content="noodp">
<meta name=author content="Klaus">
<link rel=prev href=https://msutar.com/2020/use-minio-in-windows/>
<link rel=next href=https://msutar.com/2021/choose-a-note-app/>
<link rel=canonical href=https://msutar.com/2021/nacos-config-not-refresh/>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png>
<link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5>
<meta name=msapplication-TileColor content="#da532c">
<meta name=theme-color content="#ffffff">
<title>
Nacos 配置使用 @Value 取值 | Msutar
</title>
<meta name=title content="Nacos 配置使用 @Value 取值 | Msutar">
<link rel=stylesheet href=//cdn.jsdelivr.net/gh/excas/Excas.github.io/font/iconfont.css>
<link rel=stylesheet href=//cdn.jsdelivr.net/gh/excas/Excas.github.io/css/main.min.css>
<script type=application/ld+json>{"@context":"https:\/\/msutar.com","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/msutar.com"},"articleSection":"posts","name":"Nacos 配置使用 @Value 取值","headline":"Nacos 配置使用 @Value 取值","description":"Nacos 配置使用 @Value 取值不能实时刷新","inLanguage":"zh-cn","author":"Klaus","creator":"Klaus","publisher":"Klaus","accountablePerson":"Klaus","copyrightHolder":"Klaus","copyrightYear":"2021","datePublished":"2021-05-24 00:00:00 \u002b0000 UTC","dateModified":"2021-05-24 00:00:00 \u002b0000 UTC","url":"https:\/\/msutar.com\/2021\/nacos-config-not-refresh\/","wordCount":"55","keywords":["Nacos","Msutar"]}</script>
</head>
<body>
<div class=wrapper>
<nav class=navbar>
<div class=container>
<div class="navbar-header header-logo">
<a href=javascript:void(0); class=theme-switch>❤️</a>&nbsp;<a href=https://msutar.com>Msutar</a>
</div>
<div class="menu navbar-right">
<a class=menu-item href=/posts/ title>Posts</a>
<a class=menu-item href=/categories/ title>Categories</a>
<a class=menu-item href=/tags/ title>Tags</a>
<a class=menu-item href=/tool/ title>Tool</a>
<a class=menu-item href=/about/ title>About</a>
</div>
</div>
</nav>
<nav class=navbar-mobile id=nav-mobile style=display:none>
<div class=container>
<div class=navbar-header>
<div> <a href=javascript:void(0); class=theme-switch>&nbsp;❤️&nbsp;</a><a href=https://msutar.com> Msutar</a></div>
<div class=menu-toggle>
<span></span><span></span><span></span>
</div>
</div>
<div class=menu id=mobile-menu>
<a class=menu-item href=/posts/ title>Posts</a>
<a class=menu-item href=/categories/ title>Categories</a>
<a class=menu-item href=/tags/ title>Tags</a>
<a class=menu-item href=/tool/ title>Tool</a>
<a class=menu-item href=/about/ title>About</a>
</div>
</div>
</nav>
<main class=main>
<div class=container>
<article class=post-warp itemscope itemtype=http://schema.org/Article>
<header class=post-header>
<h1 class=post-title itemprop="name headline">Nacos 配置使用 @Value 取值</h1>
<div class=post-meta>
Written by <a itemprop=name href=https://msutar.com rel=author>Klaus</a> with ♥
<span class=post-time>
on <time datetime=2021-05-24 itemprop=datePublished>May 24, 2021</time>
</span>
in
<i class="iconfont icon-folder"></i>
<span class=post-category>
<a href=https://msutar.com/categories/%E9%9A%8F%E7%AC%94/> 随笔 </a>
</span>
</div>
</header>
<div class=post-content>
<p><code>Nacos</code> 被越来越多的项目使用，我们微服务中也开始使用 <code>Nacos</code> 来做配置。</p>
<h2 id=使用-value-获取配置时不能实时刷新>使用 <code>@Value</code> 获取配置时不能实时刷新</h2>
<p>在使用中，我们可以用 <code>@Value</code> 来获取 <code>Nacos</code> 中的配置，如下</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a6e22e>@Value</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;${oss.customDomain}&#34;</span><span style=color:#f92672>)</span>
<span style=color:#66d9ef>private</span> String customDomain<span style=color:#f92672>;</span>
</code></pre></div><p>不过遇到一个问题，就是在 <code>Nacos</code> 中修改值后，控制台也有返回修改刷新，可是在应用中却没有生效，重启后才能获取到新值，</p>
<p><figure><img src=//cdn.jsdelivr.net/gh/excas/Excas.github.io/images/loading.svg data-sizes=auto data-src=https://cdn.jsdelivr.net/gh/excas/images/public/image-20211026143824982.png alt=image-20211026143824982 class=lazyload><figcaption class=image-caption>image-20211026143824982</figcaption></figure></p>
<p>经过一番摸索，其实只要简单的加上 <code>@RefreshScope</code> 即可刷新。</p>
<p><figure><img src=//cdn.jsdelivr.net/gh/excas/Excas.github.io/images/loading.svg data-sizes=auto data-src=https://cdn.jsdelivr.net/gh/excas/images/public/image-20211026143638923.png alt=image-20211026143638923 class=lazyload><figcaption class=image-caption>image-20211026143638923</figcaption></figure></p>
<h2 id=静态变量-value-取值-null>静态变量 <code>@Value</code> 取值 null</h2>
<p>在静态变量中使用 <code>@Value</code> 时，会取到 <strong>null</strong>，即直接加 <code>@Value</code> 的方法是无效的：</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a6e22e>@Value</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;${zlx.baseUrl}&#34;</span><span style=color:#f92672>)</span>
<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> String BASE_URL<span style=color:#f92672>;</span>
</code></pre></div><p>这时候需要类有 @Component 注解，再添加一个set 方法即可：</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> String BASE_URL<span style=color:#f92672>;</span>
<span style=color:#a6e22e>@Value</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;${zlx.baseUrl}&#34;</span><span style=color:#f92672>)</span>
<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setZlxBaseUrl</span><span style=color:#f92672>(</span>String baseUrl<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
   BASE_URL <span style=color:#f92672>=</span> baseUrl<span style=color:#f92672>;</span>
<span style=color:#f92672>}</span>
</code></pre></div>
</div>
<div class=post-copyright>
<p class=copyright-item>
<span>Author:</span>
<span>Klaus </span>
</p>
<p class=copyright-item>
<span>Link:</span>
<a href=https://msutar.com/2021/nacos-config-not-refresh/>https://msutar.com/2021/nacos-config-not-refresh/</span>
</p>
<p class="copyright-item lincese">
本文采用<a rel=license href=http://creativecommons.org/licenses/by-nc/4.0/ target=_blank>知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可
</p>
</div>
<div class=post-tags>
<section>
<i class="iconfont icon-tag"></i>Tag(s):
<span class=tag><a href=https://msutar.com/tags/nacos/>
#Nacos</a></span>
</section>
<section>
<a href=javascript:window.history.back();>back</a></span> ·
<span><a href=https://msutar.com>home</a></span>
</section>
</div>
<div class=post-nav>
<a href=https://msutar.com/2020/use-minio-in-windows/ class=prev rel=prev title="在 windows 使用 minio 对象存储"><i class="iconfont icon-left"></i>&nbsp;在 windows 使用 minio 对象存储</a>
<a href=https://msutar.com/2021/choose-a-note-app/ class=next rel=next title="笔记软件的选择(Typora + Github + PicGo)">笔记软件的选择(Typora + Github + PicGo)&nbsp;<i class="iconfont icon-right"></i></a>
</div>
<div class=post-comment>
</div>
</article>
</div>
</main>
<footer class=footer>
<div class=copyright>
&copy;
<span itemprop=copyrightYear>2018 - 2021</span>
<span class=with-love>
<i class="iconfont icon-love"></i>
</span>
<span class=author itemprop=copyrightHolder>Powered by <a href=https://msutar.com>Klaus</a> </span>
| <a href=https://beian.miit.gov.cn/ target=_blank rel="external nofollow">闽ICP备17008754号-2 </a>
</div>
</footer>
<link href=//cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css rel=stylesheet>
<script src=//cdn.jsdelivr.net/gh/excas/Excas.github.io/js/vendor_gallery.min.js async></script>
<script>window.localStorage&&window.localStorage.getItem('theme')==='dark'&&document.body.classList.add('dark-theme')</script>
<script>var _hmt=_hmt||[];(function(){var a=document.createElement("script"),b;a.src="https://hm.baidu.com/hm.js?d53624fc4f773c228e33cf48bdfceac3",b=document.getElementsByTagName("script")[0],b.parentNode.insertBefore(a,b)})()</script>
</div>
</body>
</html>